import os
from time import sleep

import public_pool
from public_pool import get_flag_value, chance_flag_value


def launch_tool(tool_name, docker_pentest_information_gather_volume_map_dir):
    os.chdir('{}OneForAll'.format(docker_pentest_information_gather_volume_map_dir))
    os.system('rm -rf ./results')
    global oneforall_finish_flag
    oneforall_finish_flag = False
    while oneforall_finish_flag == False:
        if get_flag_value(tool_name).find('launch') != -1:
            store_folder = get_flag_value('store_floder_name')
            log_store_folder_dir = docker_pentest_information_gather_volume_map_dir + store_folder + '/log/'
            print('{} launch'.format(tool_name))
            os.system(
                'python3 ./oneforall.py --targets ../domain.txt run 2>&1 | tee {}{}.log'.format(log_store_folder_dir,
                                                                                                tool_name))
            chance_flag_value(tool_name, 'finish')
            print('{} finish'.format(tool_name))
            oneforall_finish_flag = True
        sleep(3)


if __name__ == '__main__':
    sleep(3)
    launch_tool(public_pool.oneforall_script_process_flag_name, public_pool.docker_pentest_information_gather_volume_map_dir)
    sleep(3)
